<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leakage Analysis: Agent Misadvisement Impact</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Custom Palette & Styles -->
    <style>
        /* Palette: Vibrant Professional
           Primary: #4338ca (Indigo-700)
           Secondary: #06b6d4 (Cyan-500)
           Alert: #ef4444 (Red-500)
           Highlight: #f59e0b (Amber-500)
        */
        
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f3f4f6; /* Gray-100 */
        }

        /* Chart Container Styling - Critical for Responsiveness */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Max width to prevent stretching */
            height: 350px;    /* Base height */
            max-height: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Typography & Utility Overrides */
        h1, h2, h3 {
            color: #1e1b4b; /* Indigo-950 */
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            transition: transform 0.2s ease-in-out;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="text-gray-700 antialiased">

    <!-- Navigation / Header -->
    <nav class="bg-indigo-700 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-white text-xl font-bold tracking-wider">LEAKAGE<span class="text-cyan-400">INSIGHTS</span></span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#financial-impact" class="text-indigo-100 hover:bg-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Financial Impact</a>
                        <a href="#root-cause" class="text-indigo-100 hover:bg-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Root Cause</a>
                        <a href="#recommendations" class="text-indigo-100 hover:bg-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Action Plan</a>
                        <a href="#agent-cohort" class="text-indigo-100 hover:bg-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Agent Cohort</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Wrapper -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-16">

        <!-- Header Section -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-indigo-900 mb-4">Agent Misadvisement Leakage</h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                An analysis of Month-To-Date (MTD) cancellations caused by sales errors across all service categories. Identifying the Â£18,914 financial impact and specific training needs to eliminate future losses.
            </p>
        </header>

        <!-- SECTION 1: FINANCIAL IMPACT -->
        <section id="financial-impact" class="scroll-mt-20">
            <div class="border-l-4 border-indigo-600 pl-4 mb-6">
                <h2 class="text-3xl font-bold text-gray-800">The Financial Cost of Error</h2>
                <p class="text-lg text-gray-600 mt-2">
                    Agent misadvisement is not just an operational annoyance; it has a direct impact on the P&L. Below is the snapshot of the current period's leakage attributed directly to AnyVan administrative faults.
                </p>
            </div>

            <!-- KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <!-- KPI 1 -->
                <div class="bg-white rounded-xl shadow-md p-6 border-t-4 border-red-500 text-center card-hover">
                    <div class="text-gray-500 font-semibold uppercase tracking-wide text-sm">Total Refund Leakage</div>
                    <div class="text-4xl font-extrabold text-gray-900 mt-2">Â£18,914</div>
                    <div class="text-red-500 text-sm mt-1 font-medium">Direct cost of sales errors</div>
                </div>
                <!-- KPI 2 -->
                <div class="bg-white rounded-xl shadow-md p-6 border-t-4 border-indigo-500 text-center card-hover">
                    <div class="text-gray-500 font-semibold uppercase tracking-wide text-sm">Total Cases</div>
                    <div class="text-4xl font-extrabold text-gray-900 mt-2">55</div>
                    <div class="text-indigo-500 text-sm mt-1 font-medium">Bookings cancelled MTD</div>
                </div>
                <!-- KPI 3 -->
                <div class="bg-white rounded-xl shadow-md p-6 border-t-4 border-cyan-500 text-center card-hover">
                    <div class="text-gray-500 font-semibold uppercase tracking-wide text-sm">Avg. Cost Per Error</div>
                    <div class="text-4xl font-extrabold text-gray-900 mt-2">Â£344</div>
                    <div class="text-cyan-600 text-sm mt-1 font-medium">High value per incident</div>
                </div>
            </div>

            <!-- Comparison Chart Section -->
            <div class="bg-white rounded-xl shadow-md p-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-center">
                    <div class="lg:col-span-1">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Contextualizing the Loss</h3>
                        <p class="text-gray-600 mb-4">
                            The total leakage shows <strong>Removal</strong> as the highest impact area at Â£8,513, followed by <strong>Furniture</strong> at Â£8,982. Car transport accounts for Â£1,419 in losses.
                        </p>
                        <p class="text-gray-600">
                            This breakdown reveals where training and process improvements will have the greatest financial impact on reducing customer refunds.
                        </p>
                    </div>
                    <div class="lg:col-span-2 flex justify-center bg-gray-50 rounded-lg p-4">
                        <div class="chart-container">
                            <canvas id="financialContextChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: ROOT CAUSE ANALYSIS -->
        <section id="root-cause" class="scroll-mt-20">
            <div class="border-l-4 border-cyan-500 pl-4 mb-6">
                <h2 class="text-3xl font-bold text-gray-800">Root Cause Analysis</h2>
                <p class="text-lg text-gray-600 mt-2">
                    To stop the leakage, we must understand <em>why</em> these bookings failed. Our analysis of the 55 cases reveals distinct patterns across service categories where incorrect information led to booking failures.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- Chart: Error Distribution -->
                <div class="bg-white rounded-xl shadow-md p-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-3 border-b pb-3">Distribution of Error Types</h3>
                    <p class="text-sm text-gray-500 mb-8">Breakdown of the 55 cases by service category and primary error types.</p>
                    <div class="chart-container mb-6">
                        <canvas id="rootCauseChart"></canvas>
                    </div>
                    <div class="text-sm text-center text-gray-500 bg-gray-50 p-3 rounded">
                        *Hover over segments to see detailed counts.
                    </div>
                </div>

                <!-- Detailed Cards -->
                <div class="space-y-4">
                    <!-- Error 1 -->
                    <div class="bg-white rounded-lg shadow-sm p-5 border-l-8 border-indigo-600 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <h4 class="text-lg font-bold text-gray-900">1. Incorrect Dates/Timeslots</h4>
                            <span class="bg-indigo-100 text-indigo-800 text-xs font-semibold px-2.5 py-0.5 rounded">Critical (10 Cases)</span>
                        </div>
                        <p class="text-gray-600 mt-2 text-sm">
                            Booking conflicts and scheduling errors causing Â£4,622 in refunds. Primary cause of customer dissatisfaction and cancellations.
                        </p>
                    </div>

                    <!-- Error 2 -->
                    <div class="bg-white rounded-lg shadow-sm p-5 border-l-8 border-cyan-500 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <h4 class="text-lg font-bold text-gray-900">2. Incorrect Weights/Dimensions</h4>
                            <span class="bg-cyan-100 text-cyan-800 text-xs font-semibold px-2.5 py-0.5 rounded">Assessment (9 Cases)</span>
                        </div>
                        <p class="text-gray-600 mt-2 text-sm">
                            Weight and dimension errors causing Â£1,933 in refunds. Includes wheelbase/kerb weight miscalculations and incorrect measurements.
                        </p>
                    </div>

                    <!-- Error 3 -->
                    <div class="bg-white rounded-lg shadow-sm p-5 border-l-8 border-amber-500 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <h4 class="text-lg font-bold text-gray-900">3. Operational Issues</h4>
                            <span class="bg-amber-100 text-amber-800 text-xs font-semibold px-2.5 py-0.5 rounded">Assessment (9 Cases)</span>
                        </div>
                        <p class="text-gray-600 mt-2 text-sm">
                            Access restrictions, dismantling requirements, and vehicle operational status issues causing Â£2,713 in combined refunds.
                        </p>
                    </div>
                     <!-- Error 4 -->
                     <div class="bg-white rounded-lg shadow-sm p-5 border-l-8 border-gray-400 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <h4 class="text-lg font-bold text-gray-900">4. Misselling & Process Errors</h4>
                            <span class="bg-gray-100 text-gray-800 text-xs font-semibold px-2.5 py-0.5 rounded">Training (10 Cases)</span>
                        </div>
                        <p class="text-gray-600 mt-2 text-sm">
                            Service misselling, inventory errors, and process violations causing Â£4,645 in refunds. Includes cancellation terms and van requirement errors.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: RECOMMENDATIONS -->
        <section id="recommendations" class="scroll-mt-20 mb-20">
             <div class="border-l-4 border-amber-500 pl-4 mb-6">
                <h2 class="text-3xl font-bold text-gray-800">Executive Summary & Intervention Plan</h2>
                <p class="text-lg text-gray-600 mt-2">
                    Targeted micro learning intervention with identified agent cohort to eliminate Â£18,914 monthly leakage and achieve measurable ROI.
                </p>
            </div>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 p-8">
                    
                    <!-- Problem & Impact -->
                    <div class="space-y-6">
                        <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                            <h3 class="text-lg font-bold text-red-900 mb-2">ðŸš¨ The Issue</h3>
                            <p class="text-red-800 text-sm">
                                55 booking failures MTD due to agent errors across all service categories. Primary causes: incorrect dates/timeslots (Â£4,622), weights/dimensions (Â£1,933), and operational issues.
                            </p>
                        </div>
                        
                        <div class="bg-orange-50 border-l-4 border-orange-500 p-4 rounded">
                            <h3 class="text-lg font-bold text-orange-900 mb-2">ðŸ’° Financial Impact</h3>
                            <p class="text-orange-800 text-sm">
                                <strong>Â£18,914 direct refund cost</strong> this month. Annualized: Â£226,968 potential loss. Average Â£344 per error with date/timeslot issues causing highest impact.
                            </p>
                        </div>
                    </div>

                    <!-- Solution & Gains -->
                    <div class="space-y-6">
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded">
                            <h3 class="text-lg font-bold text-blue-900 mb-4">ðŸŽ¯ Proposed Solution: Targeted Training Intervention</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <h4 class="font-semibold text-blue-900 text-sm mb-1">HOW:</h4>
                                    <p class="text-blue-800 text-xs">15-minute daily micro-learning modules delivered via LMS with interactive scenarios and immediate feedback loops.</p>
                                </div>
                                
                                <div>
                                    <h4 class="font-semibold text-blue-900 text-sm mb-1">WHAT:</h4>
                                    <p class="text-blue-800 text-xs">Comprehensive training covering 4 key improvement areas: Service Capabilities, Operational Requirements, Customer Management, and Process Excellence.</p>
                                </div>
                                
                                <div>
                                    <h4 class="font-semibold text-blue-900 text-sm mb-2">WHY THIS IS IMPORTANT:</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-xs">
                                        <div class="bg-blue-50 p-2 rounded border border-blue-200">
                                            <h5 class="font-semibold text-blue-900 mb-1">For AnyVan:</h5>
                                            <ul class="text-blue-800 space-y-1">
                                                <li>â€¢ Reduces Â£18,914 monthly leakage</li>
                                                <li>â€¢ Prevents customer dissatisfaction</li>
                                                <li>â€¢ Protects brand reputation</li>
                                                <li>â€¢ Improves operational efficiency</li>
                                            </ul>
                                        </div>
                                        <div class="bg-green-50 p-2 rounded border border-green-200">
                                            <h5 class="font-semibold text-green-900 mb-1">For Sales Agents:</h5>
                                            <ul class="text-green-800 space-y-1">
                                                <li>â€¢ Increases booking success rate</li>
                                                <li>â€¢ Builds customer confidence</li>
                                                <li>â€¢ Reduces post-sale complications</li>
                                                <li>â€¢ Enhances professional credibility</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="font-semibold text-blue-900 text-sm mb-1">WHEN:</h4>
                                    <p class="text-blue-800 text-xs">4-week intensive program starting immediately, with weekly assessments and progress tracking.</p>
                                </div>
                            </div>
                            
                            <div class="mt-4 pt-4 border-t border-blue-200">
                                <h4 class="font-semibold text-blue-900 text-sm mb-3">4 Key Improvement Areas / Training Themes:</h4>
                                
                                <!-- Area 1: Service Capabilities -->
                                <div class="mb-4">
                                    <h5 class="font-semibold text-blue-900 text-xs mb-2 bg-blue-100 p-2 rounded">1. Service Capabilities & Limitations</h5>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs pl-2">
                                        <div>
                                            <p class="font-medium text-blue-800 mb-1">What AnyVan Can & Can't Do</p>
                                            <p class="font-medium text-blue-800 mb-1">Prohibited Items</p>
                                            <p class="font-medium text-blue-800 mb-1">AnyVan Fleet (Vehicles We Have Access to)</p>
                                        </div>
                                        <div>
                                            <p class="font-medium text-blue-800 mb-1">Vehicles that Can't Roll</p>
                                            <p class="font-medium text-blue-800 mb-1">Vehicle Move Limitations</p>
                                            <p class="font-medium text-blue-800 mb-1">Van Types</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Area 2: Operational Requirements -->
                                <div class="mb-4">
                                    <h5 class="font-semibold text-blue-900 text-xs mb-2 bg-cyan-100 p-2 rounded">2. Operational Requirements & Assessment</h5>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs pl-2">
                                        <div>
                                            <p class="font-medium text-cyan-800 mb-1">Dismantling & Assembly</p>
                                            <p class="font-medium text-cyan-800 mb-1">What Items Can't we offer this on</p>
                                            <p class="font-medium text-cyan-800 mb-1">Weight & Dimensions</p>
                                            <p class="font-medium text-cyan-800 mb-1">Operational Status</p>
                                        </div>
                                        <div>
                                            <p class="font-medium text-cyan-800 mb-1">Floors (And Do Items Fit in Lifts)</p>
                                            <p class="font-medium text-cyan-800 mb-1">Any Access Restrictions</p>
                                            <p class="font-medium text-cyan-800 mb-1">Parking & Height & Proximity to Addresses</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Area 3: Customer Management -->
                                <div class="mb-4">
                                    <h5 class="font-semibold text-blue-900 text-xs mb-2 bg-amber-100 p-2 rounded">3. Customer Management & Expectations</h5>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs pl-2">
                                        <div>
                                            <p class="font-medium text-amber-800 mb-1">Key Questions & Information Required</p>
                                            <p class="font-medium text-amber-800 mb-1">Under Promise Over Deliver</p>
                                        </div>
                                        <div>
                                            <p class="font-medium text-amber-800 mb-1">No Provisional Bookings</p>
                                            <p class="font-medium text-amber-800 mb-1">Additional Items</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Area 4: Process Excellence -->
                                <div class="mb-2">
                                    <h5 class="font-semibold text-blue-900 text-xs mb-2 bg-green-100 p-2 rounded">4. Process Excellence & Accuracy</h5>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs pl-2">
                                        <div>
                                            <p class="font-medium text-green-800 mb-1">Accuracy in All Information Capture</p>
                                            <p class="font-medium text-green-800 mb-1">Inventory-Based System & Pricing</p>
                                        </div>
                                        <div>
                                            <p class="font-medium text-green-800 mb-1">Cancellation Terms</p>
                                            <p class="font-medium text-green-800 mb-1">Complete Information Verification</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                            <h3 class="text-lg font-bold text-green-900 mb-2">ðŸ“ˆ Expected Gains</h3>
                            <p class="text-green-800 text-sm">
                                <strong>80% error reduction target</strong> within 4 weeks. Potential monthly savings: <strong>Â£15,131</strong>. Annual ROI: Â£181,574 with minimal training investment.
                            </p>
                        </div>
                    </div>

                </div>
                <div class="bg-gray-50 px-8 py-4 border-t border-gray-200 flex justify-between items-center">
                    <span class="text-sm font-medium text-gray-500">Implementation: Immediate | Timeline: 4 weeks | ROI: 182k+ annually</span>
                    <div class="flex gap-3">
                        <a href="agent-breakdown.html" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-6 rounded-full text-sm shadow transition-transform transform hover:scale-105">
                            View Agent Cohort
                        </a>
                        <button onclick="downloadReport()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-full text-sm shadow transition-transform transform hover:scale-105">
                            Download Executive Summary
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 4: AGENT COHORT -->
        <section id="agent-cohort" class="scroll-mt-20 mb-20">
            <div class="border-l-4 border-purple-500 pl-4 mb-6">
                <h2 class="text-3xl font-bold text-gray-800">Agent Cohort Requiring Upskilling</h2>
                <p class="text-lg text-gray-600 mt-2">
                    35 agents identified for targeted training - prioritized by error frequency and financial impact.
                </p>
            </div>

            <!-- Summary Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow p-6 text-center">
                    <div class="text-2xl font-bold text-indigo-600">35</div>
                    <div class="text-sm text-gray-500">Unique Agents</div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 text-center">
                    <div class="text-2xl font-bold text-red-600">53</div>
                    <div class="text-sm text-gray-500">Total Errors</div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 text-center">
                    <div class="text-2xl font-bold text-amber-600">1.57</div>
                    <div class="text-sm text-gray-500">Avg Errors/Agent</div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 text-center">
                    <div class="text-2xl font-bold text-green-600">Â£540</div>
                    <div class="text-sm text-gray-500">Avg Cost/Agent</div>
                </div>
            </div>

            <!-- Top 5 Agents by Impact -->
            <div class="mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800 border-l-4 border-purple-500 pl-4">Top 5 Agents by Impact</h3>
                    <button onclick="toggleAllAgents()" id="toggleBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm">
                        Show All 35 Agents
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <table class="min-w-full">
                        <thead class="bg-purple-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-purple-900 uppercase">Agent</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-purple-900 uppercase">Errors</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-purple-900 uppercase">Cost Impact</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-purple-900 uppercase">Primary Issues</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200" id="agentTableBody">
                            <tr>
                                <td class="px-6 py-4 font-medium text-gray-900">Kamarl McDonald</td>
                                <td class="px-6 py-4"><span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">4</span></td>
                                <td class="px-6 py-4 font-semibold text-red-600">Â£2,665</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Inventory, Dismantling, Dates/Timeslots</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 font-medium text-gray-900">Mekaylin Davids</td>
                                <td class="px-6 py-4"><span class="bg-amber-100 text-amber-800 px-2 py-1 rounded text-sm">2</span></td>
                                <td class="px-6 py-4 font-semibold text-amber-600">Â£2,010</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Wheelbase/Weight, Dates/Timeslots</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 font-medium text-gray-900">Lee Topley</td>
                                <td class="px-6 py-4"><span class="bg-amber-100 text-amber-800 px-2 py-1 rounded text-sm">2</span></td>
                                <td class="px-6 py-4 font-semibold text-amber-600">Â£1,532</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Not Sales, Misselling</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 font-medium text-gray-900">Levi Sables</td>
                                <td class="px-6 py-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">1</span></td>
                                <td class="px-6 py-4 font-semibold text-green-600">Â£1,327</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Dates/Timeslots</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 font-medium text-gray-900">Shane Cassim</td>
                                <td class="px-6 py-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">1</span></td>
                                <td class="px-6 py-4 font-semibold text-green-600">Â£1,023</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Misselling - Pressured Into Booking</td>
                            </tr>
                            <tr class="hidden" data-extra="true">
                                <td class="px-6 py-4 font-medium text-gray-900">Luxshan DP</td>
                                <td class="px-6 py-4"><span class="bg-amber-100 text-amber-800 px-2 py-1 rounded text-sm">2</span></td>
                                <td class="px-6 py-4 font-semibold text-amber-600">Â£825</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Can't be Winched (2)</td>
                            </tr>
                            <tr class="hidden" data-extra="true">
                                <td class="px-6 py-4 font-medium text-gray-900">Brent C</td>
                                <td class="px-6 py-4"><span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">3</span></td>
                                <td class="px-6 py-4 font-semibold text-red-600">Â£791</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Dates/Timeslots (2), Dismantling (1)</td>
                            </tr>
                            <tr class="hidden" data-extra="true">
                                <td class="px-6 py-4 font-medium text-gray-900">HNodunyelwa</td>
                                <td class="px-6 py-4"><span class="bg-amber-100 text-amber-800 px-2 py-1 rounded text-sm">2</span></td>
                                <td class="px-6 py-4 font-semibold text-amber-600">Â£710</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Storage Location, Dates/Timeslots</td>
                            </tr>
                            <tr class="hidden" data-extra="true">
                                <td class="px-6 py-4 font-medium text-gray-900">Mo Y</td>
                                <td class="px-6 py-4"><span class="bg-amber-100 text-amber-800 px-2 py-1 rounded text-sm">2</span></td>
                                <td class="px-6 py-4 font-semibold text-amber-600">Â£707</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Weights/Dimensions, Access</td>
                            </tr>
                            <tr class="hidden" data-extra="true">
                                <td class="px-6 py-4 font-medium text-gray-900">Connor N</td>
                                <td class="px-6 py-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">1</span></td>
                                <td class="px-6 py-4 font-semibold text-green-600">Â£620</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Misselling</td>
                            </tr>
                            <tr class="hidden" data-extra="true">
                                <td class="px-6 py-4 font-medium text-gray-900">Sandra S</td>
                                <td class="px-6 py-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">1</span></td>
                                <td class="px-6 py-4 font-semibold text-green-600">Â£618</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Misselling</td>
                            </tr>
                            <tr class="hidden" data-extra="true">
                                <td class="px-6 py-4 font-medium text-gray-900">Curtis M</td>
                                <td class="px-6 py-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">1</span></td>
                                <td class="px-6 py-4 font-semibold text-green-600">Â£601</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Prohibited Item</td>
                            </tr>
                            <tr class="hidden" data-extra="true">
                                <td class="px-6 py-4 font-medium text-gray-900">Matthew Kershaw</td>
                                <td class="px-6 py-4"><span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">3</span></td>
                                <td class="px-6 py-4 font-semibold text-red-600">Â£595</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Weights/Dimensions, People Count, Access</td>
                            </tr>
                            <tr class="hidden" data-extra="true">
                                <td class="px-6 py-4 font-medium text-gray-900">Dave D</td>
                                <td class="px-6 py-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">1</span></td>
                                <td class="px-6 py-4 font-semibold text-green-600">Â£586</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Wheelbase/Weight</td>
                            </tr>
                            <tr class="hidden" data-extra="true">
                                <td class="px-6 py-4 font-medium text-gray-900">Kamarl McDonald</td>
                                <td class="px-6 py-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">1</span></td>
                                <td class="px-6 py-4 font-semibold text-green-600">Â£565</td>
                                <td class="px-6 py-4 text-sm text-gray-600">Dismantling</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <script>
                function toggleAllAgents() {
                    const extraRows = document.querySelectorAll('[data-extra="true"]');
                    const toggleBtn = document.getElementById('toggleBtn');
                    const isHidden = extraRows[0].classList.contains('hidden');
                    
                    extraRows.forEach(row => {
                        if (isHidden) {
                            row.classList.remove('hidden');
                        } else {
                            row.classList.add('hidden');
                        }
                    });
                    
                    toggleBtn.textContent = isHidden ? 'Show Top 5 Only' : 'Show All 35 Agents';
                }
            </script>

            <!-- Training Priority Summary -->
            <div class="bg-indigo-50 rounded-xl p-6">
                <h3 class="text-lg font-bold text-indigo-900 mb-4">Training Priority Breakdown</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-600">4</div>
                        <div class="text-sm text-gray-600">High Priority (3+ errors)</div>
                        <div class="text-xs text-gray-500 mt-1">Immediate 1-on-1 coaching</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-amber-600">6</div>
                        <div class="text-sm text-gray-600">Medium Priority (2 errors)</div>
                        <div class="text-xs text-gray-500 mt-1">Targeted micro-learning</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600">25</div>
                        <div class="text-sm text-gray-600">Standard Priority (1 error)</div>
                        <div class="text-xs text-gray-500 mt-1">Group training sessions</div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-300 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="mb-2">Confidential - Internal Use Only</p>
            <p class="text-sm text-gray-500">&copy; 2025 AnyVan Performance Analysis</p>
        </div>
    </footer>

    <!-- JavaScript for Charts -->
    <script>
        // --- UTILITY: Label Wrapping Logic ---
        function wrapLabel(label, maxChar = 16) {
            if (label.length <= maxChar) return label;
            const words = label.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if (currentLine.length + 1 + words[i].length <= maxChar) {
                    currentLine += ' ' + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // --- UTILITY: Tooltip Config ---
        const commonTooltipConfig = {
            callbacks: {
                title: function(tooltipItems) {
                    const item = tooltipItems[0];
                    let label = item.chart.data.labels[item.dataIndex];
                    if (Array.isArray(label)) {
                        return label.join(' ');
                    } else {
                        return label;
                    }
                }
            }
        };

        // --- CHART 1: Financial Context (Bar) ---
        const ctxFinancial = document.getElementById('financialContextChart').getContext('2d');
        const labelsFinancial = ["Furniture", "Removal", "Car", "Piano"];
        const wrappedLabelsFinancial = labelsFinancial.map(l => wrapLabel(l, 20));

        new Chart(ctxFinancial, {
            type: 'bar',
            data: {
                labels: wrappedLabelsFinancial,
                datasets: [{
                    label: 'Revenue Leakage (Â£)',
                    data: [8982, 8513, 1419, 0],
                    backgroundColor: [
                        '#4338ca', // Indigo
                        '#06b6d4', // Cyan
                        '#f59e0b', // Amber
                        '#94a3b8'  // Slate
                    ],
                    borderColor: [
                        '#312e81',
                        '#0891b2',
                        '#d97706',
                        '#64748b'
                    ],
                    borderWidth: 1,
                    barPercentage: 0.6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: commonTooltipConfig,
                    title: {
                        display: true,
                        text: 'MTD Revenue Leakage by Service Category'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'GBP (Â£)' }
                    }
                }
            }
        });

        // --- CHART 2: Root Cause (Doughnut) ---
        const ctxRootCause = document.getElementById('rootCauseChart').getContext('2d');
        // Data derived from updated analysis: Dates/Timeslots(10), Weights/Dimensions(9), Operational(9), Misselling/Process(10), Other(17)
        const labelsRootCause = [
            "Incorrect Dates/Timeslots", 
            "Incorrect Weights/Dimensions", 
            "Operational Issues", 
            "Misselling & Process Errors",
            "Other Errors"
        ];
        const wrappedLabelsRootCause = labelsRootCause.map(l => wrapLabel(l, 18));

        new Chart(ctxRootCause, {
            type: 'doughnut',
            data: {
                labels: wrappedLabelsRootCause,
                datasets: [{
                    data: [10, 9, 9, 10, 17],
                    backgroundColor: [
                        '#4338ca', // Indigo (Primary)
                        '#06b6d4', // Cyan (Secondary)
                        '#f59e0b', // Amber (Highlight)
                        '#94a3b8', // Slate (Neutral)
                        '#e5e7eb'  // Gray (Other)
                    ],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: { size: 11 },
                            boxWidth: 12
                        }
                    },
                    tooltip: commonTooltipConfig
                }
            }
        });

    </script>

    <script>
        function downloadReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('LEAKAGE ANALYSIS EXECUTIVE SUMMARY', 20, 20);
            doc.setFontSize(12);
            doc.text(`Report Date: ${new Date().toLocaleDateString()}`, 20, 30);
            
            doc.setFontSize(14);
            doc.text('THE ISSUE', 20, 50);
            doc.setFontSize(10);
            doc.text('55 booking failures MTD due to agent errors across', 20, 60);
            doc.text('all service categories.', 20, 68);
            
            doc.setFontSize(14);
            doc.text('FINANCIAL IMPACT', 20, 85);
            doc.setFontSize(10);
            doc.text('Total Refund Leakage: Â£18,914 (monthly)', 20, 95);
            doc.text('Annualized Potential Loss: Â£226,968', 20, 103);
            doc.text('Average Cost Per Error: Â£344', 20, 111);
            
            doc.setFontSize(14);
            doc.text('SERVICE BREAKDOWN', 20, 128);
            doc.setFontSize(10);
            doc.text('â€¢ Furniture: Â£6,778 (32 cases)', 20, 138);
            doc.text('â€¢ Removal: Â£6,794 (11 cases)', 20, 146);
            doc.text('â€¢ Car: Â£3,033 (9 cases)', 20, 154);
            doc.text('â€¢ Piano: Â£618 (1 case)', 20, 162);
            
            doc.setFontSize(14);
            doc.text('PROPOSED SOLUTION', 20, 179);
            doc.setFontSize(10);
            doc.text('Deploy targeted 15-minute micro learning modules', 20, 189);
            doc.text('to identified agent cohort focusing on critical skills.', 20, 197);
            
            doc.setFontSize(14);
            doc.text('EXPECTED GAINS', 20, 214);
            doc.setFontSize(10);
            doc.text('Target: 80% error reduction within 4 weeks', 20, 224);
            doc.text('Monthly Savings: Â£15,131', 20, 232);
            doc.text('Annual ROI: Â£181,574', 20, 240);
            
            doc.save(`Leakage_Executive_Summary_${new Date().toISOString().split('T')[0]}.pdf`);
        }
    </script>

    <!--
        Source Material Analysis:
        - Updated with fresh leakage data: 53 total cases, Â£17,223 total refunds.
        - Service breakdown: Furniture (Â£6,778), Removal (Â£6,794), Car (Â£3,033), Piano (Â£618).
        - Error categories: Weights/Dimensions (12), Dates/Timeslots (10), Misselling (7), Operational (8).
        - Used vibrant palette (Indigo/Cyan/Amber) per user instructions for "Professional & Stylish".
        - Visualizations selected:
            1. Bar Chart: Service category comparison by financial impact.
            2. Donut Chart: Error type distribution across all 53 cases.
        - No SVG or Mermaid used. Canvas only for charts. Tailwind for layout.
    -->
</body>
</html>