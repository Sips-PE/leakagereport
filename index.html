<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leakage Analysis: Agent Misadvisement Impact</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Custom Palette & Styles -->
    <style>
        /* Palette: Vibrant Professional
           Primary: #4338ca (Indigo-700)
           Secondary: #06b6d4 (Cyan-500)
           Alert: #ef4444 (Red-500)
           Highlight: #f59e0b (Amber-500)
        */
        
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f3f4f6; /* Gray-100 */
        }

        /* Chart Container Styling - Critical for Responsiveness */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Max width to prevent stretching */
            height: 350px;    /* Base height */
            max-height: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Typography & Utility Overrides */
        h1, h2, h3 {
            color: #1e1b4b; /* Indigo-950 */
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            transition: transform 0.2s ease-in-out;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="text-gray-700 antialiased">

    <!-- Navigation / Header -->
    <nav class="bg-indigo-700 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-white text-xl font-bold tracking-wider">LEAKAGE<span class="text-cyan-400">INSIGHTS</span></span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#financial-impact" class="text-indigo-100 hover:bg-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Financial Impact</a>
                        <a href="#root-cause" class="text-indigo-100 hover:bg-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Root Cause</a>
                        <a href="#recommendations" class="text-indigo-100 hover:bg-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Action Plan</a>
                        <a href="agent-breakdown.html" class="text-cyan-300 hover:bg-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Agent Cohort â†’</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Wrapper -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-16">

        <!-- Header Section -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-indigo-900 mb-4">Agent Misadvisement Leakage</h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                An analysis of Month-To-Date (MTD) cancellations caused by sales errors across all service categories. Identifying the Â£17,223 financial impact and specific training needs to eliminate future losses.
            </p>
        </header>

        <!-- SECTION 1: FINANCIAL IMPACT -->
        <section id="financial-impact" class="scroll-mt-20">
            <div class="border-l-4 border-indigo-600 pl-4 mb-6">
                <h2 class="text-3xl font-bold text-gray-800">The Financial Cost of Error</h2>
                <p class="text-lg text-gray-600 mt-2">
                    Agent misadvisement is not just an operational annoyance; it has a direct impact on the P&L. Below is the snapshot of the current period's leakage attributed directly to AnyVan administrative faults.
                </p>
            </div>

            <!-- KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <!-- KPI 1 -->
                <div class="bg-white rounded-xl shadow-md p-6 border-t-4 border-red-500 text-center card-hover">
                    <div class="text-gray-500 font-semibold uppercase tracking-wide text-sm">Total Refund Leakage</div>
                    <div class="text-4xl font-extrabold text-gray-900 mt-2">Â£17,223</div>
                    <div class="text-red-500 text-sm mt-1 font-medium">Direct cost of sales errors</div>
                </div>
                <!-- KPI 2 -->
                <div class="bg-white rounded-xl shadow-md p-6 border-t-4 border-indigo-500 text-center card-hover">
                    <div class="text-gray-500 font-semibold uppercase tracking-wide text-sm">Total Cases</div>
                    <div class="text-4xl font-extrabold text-gray-900 mt-2">53</div>
                    <div class="text-indigo-500 text-sm mt-1 font-medium">Bookings cancelled MTD</div>
                </div>
                <!-- KPI 3 -->
                <div class="bg-white rounded-xl shadow-md p-6 border-t-4 border-cyan-500 text-center card-hover">
                    <div class="text-gray-500 font-semibold uppercase tracking-wide text-sm">Avg. Cost Per Error</div>
                    <div class="text-4xl font-extrabold text-gray-900 mt-2">Â£325</div>
                    <div class="text-cyan-600 text-sm mt-1 font-medium">High value per incident</div>
                </div>
            </div>

            <!-- Comparison Chart Section -->
            <div class="bg-white rounded-xl shadow-md p-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-center">
                    <div class="lg:col-span-1">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Contextualizing the Loss</h3>
                        <p class="text-gray-600 mb-4">
                            The total leakage across all categories shows <strong>Furniture</strong> as the highest impact area at Â£6,778, followed by <strong>Removal</strong> at Â£6,794. Car transport accounts for Â£3,033 in losses.
                        </p>
                        <p class="text-gray-600">
                            This breakdown reveals where training and process improvements will have the greatest financial impact on reducing customer refunds.
                        </p>
                    </div>
                    <div class="lg:col-span-2 flex justify-center bg-gray-50 rounded-lg p-4">
                        <div class="chart-container">
                            <canvas id="financialContextChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: ROOT CAUSE ANALYSIS -->
        <section id="root-cause" class="scroll-mt-20">
            <div class="border-l-4 border-cyan-500 pl-4 mb-6">
                <h2 class="text-3xl font-bold text-gray-800">Root Cause Analysis</h2>
                <p class="text-lg text-gray-600 mt-2">
                    To stop the leakage, we must understand <em>why</em> these bookings failed. Our analysis of the 53 cases reveals distinct patterns across service categories where incorrect information led to booking failures.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- Chart: Error Distribution -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-2 border-b pb-2">Distribution of Error Types</h3>
                    <p class="text-sm text-gray-500 mb-6">Breakdown of the 53 cases by service category and primary error types.</p>
                    <div class="chart-container">
                        <canvas id="rootCauseChart"></canvas>
                    </div>
                    <div class="mt-4 text-sm text-center text-gray-500 bg-gray-50 p-2 rounded">
                        *Hover over segments to see detailed counts.
                    </div>
                </div>

                <!-- Detailed Cards -->
                <div class="space-y-4">
                    <!-- Error 1 -->
                    <div class="bg-white rounded-lg shadow-sm p-5 border-l-8 border-indigo-600 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <h4 class="text-lg font-bold text-gray-900">1. Incorrect Weights/Dimensions</h4>
                            <span class="bg-indigo-100 text-indigo-800 text-xs font-semibold px-2.5 py-0.5 rounded">Critical (12 Cases)</span>
                        </div>
                        <p class="text-gray-600 mt-2 text-sm">
                            Furniture (9 cases) and Car transport (3 cases) failures due to missing or incorrect physical specifications. Includes kerb weight errors and missing furniture dimensions.
                        </p>
                    </div>

                    <!-- Error 2 -->
                    <div class="bg-white rounded-lg shadow-sm p-5 border-l-8 border-cyan-500 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <h4 class="text-lg font-bold text-gray-900">2. Incorrect Dates/Timeslots</h4>
                            <span class="bg-cyan-100 text-cyan-800 text-xs font-semibold px-2.5 py-0.5 rounded">Process (10 Cases)</span>
                        </div>
                        <p class="text-gray-600 mt-2 text-sm">
                            Booking conflicts across Furniture (7), Removal (2), and Car (1) services. Agents scheduling pickups outside customer availability windows.
                        </p>
                    </div>

                    <!-- Error 3 -->
                    <div class="bg-white rounded-lg shadow-sm p-5 border-l-8 border-amber-500 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <h4 class="text-lg font-bold text-gray-900">3. Misselling Services</h4>
                            <span class="bg-amber-100 text-amber-800 text-xs font-semibold px-2.5 py-0.5 rounded">Training (7 Cases)</span>
                        </div>
                        <p class="text-gray-600 mt-2 text-sm">
                            Promising services not offered: Furniture (3), Removal (3), Piano (1). Includes H&S violations and service capability misunderstandings.
                        </p>
                    </div>
                     <!-- Error 4 -->
                     <div class="bg-white rounded-lg shadow-sm p-5 border-l-8 border-gray-400 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <h4 class="text-lg font-bold text-gray-900">4. Operational/Access Issues</h4>
                            <span class="bg-gray-100 text-gray-800 text-xs font-semibold px-2.5 py-0.5 rounded">Assessment (8 Cases)</span>
                        </div>
                        <p class="text-gray-600 mt-2 text-sm">
                            Vehicle operational status (4), access restrictions (3), and dismantling requirements (4) not properly assessed during booking.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: RECOMMENDATIONS -->
        <section id="recommendations" class="scroll-mt-20 mb-20">
             <div class="border-l-4 border-amber-500 pl-4 mb-6">
                <h2 class="text-3xl font-bold text-gray-800">Executive Summary & Intervention Plan</h2>
                <p class="text-lg text-gray-600 mt-2">
                    Targeted micro learning intervention with identified agent cohort to eliminate Â£17,223 monthly leakage and achieve measurable ROI.
                </p>
            </div>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 p-8">
                    
                    <!-- Problem & Impact -->
                    <div class="space-y-6">
                        <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                            <h3 class="text-lg font-bold text-red-900 mb-2">ðŸš¨ The Issue</h3>
                            <p class="text-red-800 text-sm">
                                53 booking failures MTD due to agent errors across Furniture, Removal, Car, and Piano services. Primary causes: incorrect dimensions, timeslot conflicts, and service misselling.
                            </p>
                        </div>
                        
                        <div class="bg-orange-50 border-l-4 border-orange-500 p-4 rounded">
                            <h3 class="text-lg font-bold text-orange-900 mb-2">ðŸ’° Financial Impact</h3>
                            <p class="text-orange-800 text-sm">
                                <strong>Â£17,223 direct refund cost</strong> this month. Annualized: Â£206,676 potential loss. Average Â£325 per error with high-value Removal services most affected.
                            </p>
                        </div>
                    </div>

                    <!-- Solution & Gains -->
                    <div class="space-y-6">
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                            <h3 class="text-lg font-bold text-blue-900 mb-2">ðŸŽ¯ Proposed Solution</h3>
                            <p class="text-blue-800 text-sm">
                                Deploy targeted 15-minute micro learning modules to identified agent cohort. Focus on critical skills: dimension capture, service limitations, and booking accuracy.
                            </p>
                        </div>
                        
                        <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                            <h3 class="text-lg font-bold text-green-900 mb-2">ðŸ“ˆ Expected Gains</h3>
                            <p class="text-green-800 text-sm">
                                <strong>80% error reduction target</strong> within 4 weeks. Potential monthly savings: <strong>Â£13,778</strong>. Annual ROI: Â£165,341 with minimal training investment.
                            </p>
                        </div>
                    </div>

                </div>
                <div class="bg-gray-50 px-8 py-4 border-t border-gray-200 flex justify-between items-center">
                    <span class="text-sm font-medium text-gray-500">Implementation: Immediate | Timeline: 4 weeks | ROI: 165k+ annually</span>
                    <div class="flex gap-3">
                        <a href="agent-breakdown.html" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-6 rounded-full text-sm shadow transition-transform transform hover:scale-105">
                            View Agent Cohort
                        </a>
                        <button onclick="downloadReport()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-full text-sm shadow transition-transform transform hover:scale-105">
                            Download Executive Summary
                        </button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-300 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="mb-2">Confidential - Internal Use Only</p>
            <p class="text-sm text-gray-500">&copy; 2025 AnyVan Performance Analysis</p>
        </div>
    </footer>

    <!-- JavaScript for Charts -->
    <script>
        // --- UTILITY: Label Wrapping Logic ---
        function wrapLabel(label, maxChar = 16) {
            if (label.length <= maxChar) return label;
            const words = label.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if (currentLine.length + 1 + words[i].length <= maxChar) {
                    currentLine += ' ' + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // --- UTILITY: Tooltip Config ---
        const commonTooltipConfig = {
            callbacks: {
                title: function(tooltipItems) {
                    const item = tooltipItems[0];
                    let label = item.chart.data.labels[item.dataIndex];
                    if (Array.isArray(label)) {
                        return label.join(' ');
                    } else {
                        return label;
                    }
                }
            }
        };

        // --- CHART 1: Financial Context (Bar) ---
        const ctxFinancial = document.getElementById('financialContextChart').getContext('2d');
        const labelsFinancial = ["Furniture", "Removal", "Car", "Piano"];
        const wrappedLabelsFinancial = labelsFinancial.map(l => wrapLabel(l, 20));

        new Chart(ctxFinancial, {
            type: 'bar',
            data: {
                labels: wrappedLabelsFinancial,
                datasets: [{
                    label: 'Revenue Leakage (Â£)',
                    data: [6778, 6794, 3033, 618],
                    backgroundColor: [
                        '#4338ca', // Indigo
                        '#06b6d4', // Cyan
                        '#f59e0b', // Amber
                        '#94a3b8'  // Slate
                    ],
                    borderColor: [
                        '#312e81',
                        '#0891b2',
                        '#d97706',
                        '#64748b'
                    ],
                    borderWidth: 1,
                    barPercentage: 0.6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: commonTooltipConfig,
                    title: {
                        display: true,
                        text: 'MTD Revenue Leakage by Service Category'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'GBP (Â£)' }
                    }
                }
            }
        });

        // --- CHART 2: Root Cause (Doughnut) ---
        const ctxRootCause = document.getElementById('rootCauseChart').getContext('2d');
        // Data derived from new analysis: Weights/Dimensions(12), Dates/Timeslots(10), Misselling(7), Operational/Access(8), Other(16)
        const labelsRootCause = [
            "Incorrect Weights/Dimensions", 
            "Incorrect Dates/Timeslots", 
            "Misselling Services", 
            "Operational/Access Issues",
            "Other Errors"
        ];
        const wrappedLabelsRootCause = labelsRootCause.map(l => wrapLabel(l, 18));

        new Chart(ctxRootCause, {
            type: 'doughnut',
            data: {
                labels: wrappedLabelsRootCause,
                datasets: [{
                    data: [12, 10, 7, 8, 16],
                    backgroundColor: [
                        '#4338ca', // Indigo (Primary)
                        '#06b6d4', // Cyan (Secondary)
                        '#f59e0b', // Amber (Highlight)
                        '#94a3b8', // Slate (Neutral)
                        '#e5e7eb'  // Gray (Other)
                    ],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: { size: 11 },
                            boxWidth: 12
                        }
                    },
                    tooltip: commonTooltipConfig
                }
            }
        });

    </script>

    <script>
        function downloadReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('LEAKAGE ANALYSIS EXECUTIVE SUMMARY', 20, 20);
            doc.setFontSize(12);
            doc.text(`Report Date: ${new Date().toLocaleDateString()}`, 20, 30);
            
            doc.setFontSize(14);
            doc.text('THE ISSUE', 20, 50);
            doc.setFontSize(10);
            doc.text('53 booking failures MTD due to agent errors across', 20, 60);
            doc.text('Furniture, Removal, Car, and Piano services.', 20, 68);
            
            doc.setFontSize(14);
            doc.text('FINANCIAL IMPACT', 20, 85);
            doc.setFontSize(10);
            doc.text('Total Refund Leakage: Â£17,223 (monthly)', 20, 95);
            doc.text('Annualized Potential Loss: Â£206,676', 20, 103);
            doc.text('Average Cost Per Error: Â£325', 20, 111);
            
            doc.setFontSize(14);
            doc.text('SERVICE BREAKDOWN', 20, 128);
            doc.setFontSize(10);
            doc.text('â€¢ Furniture: Â£6,778 (32 cases)', 20, 138);
            doc.text('â€¢ Removal: Â£6,794 (11 cases)', 20, 146);
            doc.text('â€¢ Car: Â£3,033 (9 cases)', 20, 154);
            doc.text('â€¢ Piano: Â£618 (1 case)', 20, 162);
            
            doc.setFontSize(14);
            doc.text('PROPOSED SOLUTION', 20, 179);
            doc.setFontSize(10);
            doc.text('Deploy targeted 15-minute micro learning modules', 20, 189);
            doc.text('to identified agent cohort focusing on critical skills.', 20, 197);
            
            doc.setFontSize(14);
            doc.text('EXPECTED GAINS', 20, 214);
            doc.setFontSize(10);
            doc.text('Target: 80% error reduction within 4 weeks', 20, 224);
            doc.text('Monthly Savings: Â£13,778', 20, 232);
            doc.text('Annual ROI: Â£165,341', 20, 240);
            
            doc.save(`Leakage_Executive_Summary_${new Date().toISOString().split('T')[0]}.pdf`);
        }
    </script>

    <!--
        Source Material Analysis:
        - Updated with fresh leakage data: 53 total cases, Â£17,223 total refunds.
        - Service breakdown: Furniture (Â£6,778), Removal (Â£6,794), Car (Â£3,033), Piano (Â£618).
        - Error categories: Weights/Dimensions (12), Dates/Timeslots (10), Misselling (7), Operational (8).
        - Used vibrant palette (Indigo/Cyan/Amber) per user instructions for "Professional & Stylish".
        - Visualizations selected:
            1. Bar Chart: Service category comparison by financial impact.
            2. Donut Chart: Error type distribution across all 53 cases.
        - No SVG or Mermaid used. Canvas only for charts. Tailwind for layout.
    -->
</body>
</html>